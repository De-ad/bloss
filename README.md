# Бизнес-логика программных систем

- Сайт -> [Rottentomatoes](https://www.rottentomatoes.com/)
- Нотация -> [BPMN 2.0](http://www.bpmb.de/images/BPMN2_0_Poster_RU.pdf)

## Вариант №7396

Доработать приложение из лабораторной работы #1, реализовав в нём управление транзакциями и разграничение доступа к операциям бизнес-логики в соответствии с заданной политикой доступа.

## Управление транзакциями

1. Переработать согласованные с преподавателем прецеденты (или по согласованию с ним разработать новые), объединив взаимозависимые операции в рамках транзакций.
2. Управление транзакциями необходимо реализовать с помощью Spring JTA.
3. В реализованных (или модифицированных) прецедентах необходимо использовать декларативное управление транзакциями.
4. В качестве менеджера транзакций необходимо использовать Atomikos.

## Разграничение доступа к операциям необходимо реализовать следующим образом:

1. Разработать, специфицировать и согласовать с преподавателем набор привилегий, в соответствии с которыми будет разграничиваться доступ к операциям.
2. Специфицировать и согласовать с преподавателем набор ролей, осуществляющих доступ к операциям бизнес-логики приложения.
3. Реализовать разработанную модель разграничений доступа к операциям бизнес-логики на базе Spring Security. Информацию об учётных записах пользователей необходимо сохранять в реляционую базу данных, для аутентификации использовать JWT.

## Правила выполнения работы:

1. Все изменения, внесённые в реализуемый бизнес-процесс, должны быть учтены в описывающей его модели, REST API и наборе скриптов для тестирования публичных интерфейсов модуля.
2. Доработанное приложение необходимо развернуть на сервере helios.

## Отчёт

### Модель потока управления для автоматизируемого бизнес-процесса

Модель

!["BP model"](./img/bloss.drawio-lab2.svg)

### Спецификация пользовательских привилегий и ролей, реализованных в приложении

#### NO_ROLE

- Чтение проверенных данных (GET)
- Регистрация/Логин

#### ROLE_USER

- Всё, что доступно NO_ROLE
- Манипуляция (создание/удаление/изменение) своими отзывами

#### ROLE_ADMIN

- Всё, что доступно ROLE_USER
- Манипуляция чужими данными (в том числе проверка сырых отзывов)

#### ROLE_SUPER_ADMIN

- Всё, что доступно ROLE_ADMIN
- Получение информации о всех ROLE_USER системы
- Выдача роли ROLE_ADMIN

### Спецификация REST API для всех публичных интерфейсов разработанного приложения.

- `/admin`
  - `/{username}` - присвоить пользователю роль администратора
    - ROLE_SUPER_ADMIN
    - POST
      - *username* - логин пользователя, которому присвается ROLE_ADMIN
    - RET: user
  - `/users` - получить список всех пользователей
    - ROLE_SUPER_ADMIN
    - GET
    - RET: user[]
- `/enter`
  - `/register` - зарегестироваться в системе
    - NO_ROLE
    - POST
      - *username* - логин пользователя
      - *password* - пароль пользователя
      - *name* - имя пользователя
      - *surname* - фамилия пользователя
    - RET: {id, username, token}
  - `/login` - залогиниться в системе
    - NO_ROLE
    - POST
      - *username* - логин пользователя
      - *password* - пароль пользователя
    - RET: {id, username, token}
- `/films`
  - ` ` - получить список всех фильмов
    - NO_ROLE
    - GET
    - RET: film[]
  - `/{id}` - получить конкретный фильм
    - NO_ROLE
    - GET
      - *id* - идентификатор фильма
    - RET: film
  - ` ` - создать фильм
    - ROLE_ADMIN
    - POST
      - *name* - имя фильма
      - *description* - описание фильма
    - RET: film
  - ` ` - изменить фильм
    - ROLE_ADMIN
    - PUT
      - *id* - идентификатор фильма
      - *name* - новое имя фильма
      - *description* - новое описание фильма
    - RET: film
  - `/{id}` - удалить выбранный фильм
    - ROLE_ADMIN
    - DELETE
      - *id* - идентификатор удаляемого фильма
    - RET: null (204)
- `/reviews`
  - ` ` - получить список всех принятых отзывов
    - NO_ROLE
    - GET
    - RET: review[]
  - `/{id}` - получить выбранный отзыв, если он принят
    - NO_ROLE
    - GET
      - *id* - идентификатор отзыва
    - RET: review
  - ` ` - создать новый отзыв
    - ROLE_USER
    - POST
      - *filmId* - идентификатор фильма, к которому прилагается отзыв
      - *text* - текст отзыва
      - *score* - рейтинг отзыва (int)
    - RET: review
  - ` ` - изменить существующий отзыв
    - ROLE_USER
    - PUT
      - *id* - идентификатор отзыва 
      - *filmId* - идентификатор фильма, к которому прилагается отзыв
      - *text* - новый текст отзыва
      - *score* - новый рейтинг отзыва (int)
    - RET: review
  - `/{id}` - удалить выбранный отзыв
    - ROLE_USER
    - DELETE
      - *id* - идентификатор отзыва
    - RET: null (204)
  - `/raw` - просмотреть все сырые отзывы (on-review, rejected) 
    - ROLE_ADMIN
    - GET
    - RET: review[]
  - `/{id}/approve` - принять отзыв
    - ROLE_ADMIN
    - POST
      - *id* - идентификатор отзыва
    - RET: review
  - `/{id}/reject` - отклонить отзыв
    - ROLE_ADMIN
    - POST
      - *id* - идентификатор отзыва
    - RET: review

### Выводы по работе.

#### Тучков Максим Русланович

В ходе работы я научился реализовывать управление транзакциями и разграничение доступа к операциям бизнес-логики в соответствии с заданной политикой доступа в spring boot приложении.

#### Кондратьева Ксения Михайловна

В ходе работы я научилась реализовывать управление транзакциями и разграничение доступа к операциям бизнес-логики в соответствии с заданной политикой доступа в spring boot приложении.

## Вопросы к защите лабораторной работы

1. Понятие транзакции. Особенности реализации транзакций на уровне бизнес-логики, отличия от транзакций на уровне БД.
2. Распределённые транзакции, спецификация XA. Реализация в приложениях на базе Java EE и Spring.
3. Реализация управления транзакциями в Spring. Аннотация @Transactional. Декларативное и программное управления транзакциями.
4. Java Transaction API. Основные принципы и программные интерфейсы. Работа с JTA в приложениях на базе Spring / Spring Boot.
5. Менеджеры транзакций: Atomikos, Bitronix. Использование менеджера транзакций Java EE в приложениях на базе Spring / Spring Boot.
6. Разграничение доступа и политики безопасности в корпоративных приложениях. Пользователи, роли и привилегии. Реализация политик безопасности на уровне бизнес-логики.
7. Технология Spring Security. Основные понятия, аннотации, конфигурационные файлы и API. Использование на уровне бизнес-логики.
8. Технология JAAS. Основные понятия, конфигурационные файлы и API. Использование на уровне бизнес-логики, в т.ч. совместно с Spring Security.
9. Способы хранения информации об учётных записях пользователей в приложениях на Java.
10. Подходы к реализации аутентификации пользователей в приложениях на Java.

## Выполнили

> Тучков Максим Русланович
> 
> Кондратьева Ксения Михайловна
